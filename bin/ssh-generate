#!/bin/sh

# shellcheck source=./common.sh
source "common.sh"

# Generating a new SSH key
# https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent

id="${1:-$ID_EMAIL}"
file="${HOME}/.ssh/$(email-to-hash "${id}")"

log_info "$id"
log_info "$file"

if [ -f "$file" ]; then
  log_error "File '$file' exists!"
fi

log_success 'Generating a new SSH key'

# Generate Keypair - Enter and password
ssh-keygen \
  -q \
  -b 4096 \
  -t "rsa" \
  -N "" \
  -C "${id}" \
  -f "${file}"

chmod 600 "${file}"
chmod 644 "${file}.pub"

ls -la "${HOME}/.ssh"

#Host *
#  AddKeysToAgent yes
#  UseKeychain yes
#  IdentityFile ~/.ssh/id_rsa
