#!/bin/sh

# shellcheck source=./common.sh
source "common.sh"

log_warn "Down docker! ğŸš›"

#log_info "=> Remove all containers âœ…"
#log_info "=> Remove all unused networks âœ…"
#log_info "Remove docker... ğŸš’"
#log_info "=> Remove all containers and volumes ğŸš’"
#log_info "=> Remove all networks ğŸš’"
#log_info "=> Remove all images ğŸš’"

# declare an array
declare -a container_ids=($(docker container list --all --quiet))
declare -a image_ids=($(docker images --all --quiet))

log_info "Containers all: ${#container_ids[@]}"
#log_info "Images all: ${#image_ids[@]}"

read -r -p "Stop all containers? [y/N] " prune_images

if [[ "$prune_images" =~ ^([yY][eE][sS]|[yY])$ ]]; then
  if docker container stop "$container_ids" &>/dev/null; then
    log_success "=> Stop all containers âœ…"
  fi
fi

if docker container prune --force &>/dev/null; then
  log_success "=> Remove all stopped containers ğŸš’"
fi

if docker network prune --force &>/dev/null; then
  log_success "=> Remove all unused networks ğŸ–¥"
fi

if docker volume prune --force &>/dev/null; then
  log_success "=> Remove all unused local volumes"
fi

#if docker rmi --force $(docker images --all --quiet) &>/dev/null; then
#  log_success "=> Remove all images ğŸ–¼"
#fi
